<!--
  ~ Copyright (c) Akveo 2019. All Rights Reserved.
  ~ Licensed under the Single Application / Multi Application License.
  ~ See LICENSE_SINGLE_APP / LICENSE_MULTI_APP in the 'docs' folder for license information on type of purchased license.
  -->


<div class="container-xxl">
  <div class="row">
    <div class="col-xl-12 form-container">
      <nav class="navigation" *ngIf="!isTokenSet">
        <a (click)="back()"
           class="link back-link" aria-label="Back">
          <nb-icon icon="arrow-back"></nb-icon>
        </a>
      </nav>
      <h1 id="title" class="title">Changer le mot de passe</h1>
      <p class="sub-title">Veuillez d√©finir un nouveau mot de passe</p>
      <div [formGroup]="resetPasswordForm" aria-labelledby="title">

        <div class="row">
          <div class="form-control-group col-md-12">
            <label for="password-input">Mot de passe</label>
            <div class="input-group">
              <input  nbInput
                      fieldSize
                      class="form-control"
                      id="password-input"
                      formControlName="password"
                      [type]="getInputType()"
                      [status]="password.dirty ? (password.invalid  ? 'danger' : 'success') : 'basic'"
                      placeholder="Mot de passse"
              >
              <div class="input-group-append">
                <button class="btn btn-info btn-lg" (click)="toggleShowPassword()">
                  <i class="{{showPassword ? 'fas fa-eye-slash' : 'fas fa-eye' }}"></i>
                </button>
              </div>
            </div>
            <ngx-validation-message label="Password" [showMinLength]="password?.hasError('minlength') && password.touched"
                                    [showMaxLength]="password?.hasError('maxlength') && password.touched"
                                    [showRequired]="password?.errors?.required && password.touched"
                                    [minLength]="minLength"
                                    [maxLength]="maxLength"></ngx-validation-message>
          </div>
          <div class="form-control-group col-md-12">
            <label for="input-re-password">Confirmez le mot de passe</label>
            <input  nbInput
                    fieldSize
                    class="form-control"
                    id="input-re-password"
                    formControlName="confirmPassword"
                    type="password"
                    [status]="confirmPassword.dirty ? (confirmPassword.invalid || password.value != confirmPassword.value  ? 'danger' : 'success') : 'basic'"
                    placeholder="Mot de passe">
            <ngx-validation-message label="Confirmation du mot de passe"
                                    [showMinLength]="confirmPassword?.hasError('minlength') && confirmPassword.touched"
                                    [showMaxLength]="confirmPassword?.hasError('maxlength') && confirmPassword.touched"
                                    [showRequired]="confirmPassword?.errors?.required && confirmPassword.touched"
                                    [minLength]="minLength"
                                    [maxLength]="maxLength"
                                    [showConfirmPassword]="password.value != confirmPassword.value && confirmPassword.touched"></ngx-validation-message>
          </div>
        </div>

        <button nbButton status="primary" fullWidth class="connexion-button" [disabled]="!resetPasswordForm.valid || password.value != confirmPassword.value"
                [class.btn-pulse]="submitted"
                (click)="resetPass()">
          Confirmer
        </button>
        <nb-alert *ngIf="(result$ | async) as result; else errorTemplate" outline="success" role="alert">
          <ul class="alert-message-list">
            <li  class="alert-message">{{ result }}</li>
          </ul>
        </nb-alert>
        <nb-alert #errorTemplate *ngIf="(errors$ | async) as errorObs" outline="danger" role="alert">
          <ul class="alert-message-list">
            <li class="alert-message">{{ errorObs }}</li>
          </ul>
        </nb-alert>



      </div>
    </div>
  </div>
</div>
